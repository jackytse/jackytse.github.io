<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 升级到 Ionic 3 · 云鹏的博客</title><meta name="description" content="升级到 Ionic 3 - Jacky Tse"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://www.jackytse.me/atom.xml" title="云鹏的博客"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/logo.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/jackytse" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">升级到 Ionic 3</h1><div class="post-info">May 3, 2017</div><div class="post-content"><p><img src="http://jackytse-me.gz.bcebos.com/migrate-to-ionic3/migrate-to-ionic3-00001.jpg" alt></p>
<p>Ionic 3 正式发布已经近一个月了，很多朋友惊呼 Ionic 2 还没上手 Ionic 3 又发布了，会不会又要花很大精力去学习等。认真研究了下，我发现 Ionic 2 到 Ionic 3 的升级只是一些类库的升级，并不需要像 Ionic 1 到 Ionic 2 那样完全重写代码。下面就花点时间给大家介绍下 Ionic 3 的特性以及如何从 Ionic 2 升级到 Ionic 3。</p>
<h2 id="Ionic-3-的新特性"><a href="#Ionic-3-的新特性" class="headerlink" title="Ionic 3 的新特性"></a>Ionic 3 的新特性</h2><blockquote>
<p>关于 Ionic 3 的详细说明可以参考<a href="http://blog.ionic.io/ionic-3-0-has-arrived/" target="_blank" rel="noopener">官方博客</a></p>
</blockquote>
<h4 id="0-Angular-4"><a href="#0-Angular-4" class="headerlink" title="#0 Angular 4"></a>#0 Angular 4</h4><p>Angular 4 是在3月底发布的。Angular 4 这次更新大致如下：改进 AOT 编译器，分离 animations 包，缩小生成后的代码量，改进 <code>*ngIf</code> 和 <code>*ngFor</code> 等。详细介绍请参<a href="http://angularjs.blogspot.jp/2017/03/angular-400-now-available.html" target="_blank" rel="noopener">这篇文章</a>。</p>
<a id="more"></a>
<h4 id="1-兼容-Typescript-2-1-和-2-2"><a href="#1-兼容-Typescript-2-1-和-2-2" class="headerlink" title="#1 兼容 Typescript 2.1 和 2.2"></a>#1 兼容 Typescript 2.1 和 2.2</h4><p>这个其实就是 Angular 4 带来的新特性。</p>
<h4 id="2-IonicPage-装饰器"><a href="#2-IonicPage-装饰器" class="headerlink" title="#2 IonicPage 装饰器"></a>#2 IonicPage 装饰器</h4><p>IonicPage 装饰器将 URL 注册到特定页面。Ionic 使用了一套叫做 deeplink 的 URL 系统，当使用 NavController push 到新页面时，URL 随之更新。注意这和 URL routing 是不同的。关于 IonicPage 的详细介绍请参考<a href="http://ionicframework.com/docs/api/navigation/IonicPage/" target="_blank" rel="noopener">官方文档</a>。</p>
<h4 id="3-Lazy-Loading-懒加载"><a href="#3-Lazy-Loading-懒加载" class="headerlink" title="#3 Lazy Loading 懒加载"></a>#3 Lazy Loading 懒加载</h4><p>Lazy Loading 可以在初始化时只加载一些必要的代码，非必要的代码分离出来在需要加载的时候再加载之，理论上能让应用加快一定的启动速度。</p>
<h2 id="升级到-Ionic-3"><a href="#升级到-Ionic-3" class="headerlink" title="升级到 Ionic 3"></a>升级到 Ionic 3</h2><h4 id="0-修改-npm-依赖包"><a href="#0-修改-npm-依赖包" class="headerlink" title="#0 修改 npm 依赖包"></a>#0 修改 npm 依赖包</h4><p>从 Ionic 2 开始使用了 npm 去管理包，所以我们在 <code>package.json</code> 文件的 <code>dependencies</code> 节点中修改依赖项。</p>
<ul>
<li>修改 <code>ionic-angular</code> 到当前最新的 <code>3.1.1</code> 版本。</li>
<li><code>ionic-angular</code> 依赖 Angular 4.0.2 版本，将所有 <code>@angular/*</code> 开头的包修改为 <code>4.0.2</code> 版本，增加 <code>@angular/animations</code> 包。</li>
<li>删除 <code>ionic-native</code> 包，添加所需的 <code>@ionic-native/*</code> 包，最新版本为 <code>3.6.1</code></li>
<li>将 <code>rxjs</code> 修改到依赖的 <code>5.1.1</code> 版本。</li>
<li>将 <code>zone.js</code> 修改到依赖的 <code>0.8.5</code> 版本。</li>
</ul>
<p>修改完成后，执行 <code>npm install</code> 命令，若 npm 仍提示有依赖问题，参考错误提示逐一解决就好。</p>
<h4 id="1-修改代码以支持-Ionic-Native-3-x"><a href="#1-修改代码以支持-Ionic-Native-3-x" class="headerlink" title="#1 修改代码以支持 Ionic Native 3.x"></a>#1 修改代码以支持 Ionic Native 3.x</h4><p>参考 <a href="http://ionicframework.com/docs/native/" target="_blank" rel="noopener">Ionic Native 文档</a> 修改 <code>StatusBar</code> 和 <code>SplashScreen</code> 的引用方式。</p>
<h4 id="2-修改代码以支持-Lazy-Loading-非必需"><a href="#2-修改代码以支持-Lazy-Loading-非必需" class="headerlink" title="#2 修改代码以支持 Lazy Loading (非必需)"></a>#2 修改代码以支持 Lazy Loading (非必需)</h4><ul>
<li>在每个 Page 对应的目录下新建一个 <code>[pagename].module.ts</code> 文件，代码大致如下：<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; NgModule &#125; <span class="keyword">from</span> <span class="string">'@angular/core'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; IonicPageModule &#125; <span class="keyword">from</span> <span class="string">'ionic-angular'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Tabs &#125; <span class="keyword">from</span> <span class="string">'./tabs'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NgModule</span>(&#123;</span><br><span class="line">  declarations: [</span><br><span class="line">    Tabs,</span><br><span class="line">  ],</span><br><span class="line">  imports: [</span><br><span class="line">    IonicPageModule.forChild(Tabs),</span><br><span class="line">  ],</span><br><span class="line">  exports: [</span><br><span class="line">    Tabs</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AboutModule &#123;&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://jackytse-me.gz.bcebos.com/migrate-to-ionic3/migrate-to-ionic3-00002.png" alt></p>
<ul>
<li>删除项目中所有 Page 的引入，并将对 Page 类的引用修改成对应 Page 的字符串名称。</li>
</ul>
<p><img src="http://jackytse-me.gz.bcebos.com/migrate-to-ionic3/migrate-to-ionic3-00003.png" alt></p>
<h2 id="错误解决"><a href="#错误解决" class="headerlink" title="错误解决"></a>错误解决</h2><p>修改完成后，执行 <code>ionic serve</code> 运行，若有报错，则通过错误信息解决之。<br>我遇到这个错误：<code>“No provider for ApplicationInitStatus!”</code></p>
<p>解决办法是在 <code>app.module.ts</code> 文件中添加如下引用：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; BrowserModule &#125; <span class="keyword">from</span> <span class="string">'@angular/platform-browser'</span>;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="meta">@NgModule</span>(&#123;</span><br><span class="line">  imports: [</span><br><span class="line">    HttpModule, </span><br><span class="line">    BrowserModule, </span><br><span class="line">    IonicModule.forRoot(MyApp)</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="结束的话"><a href="#结束的话" class="headerlink" title="结束的话"></a>结束的话</h2><p>到 Ionic 3 的升级并不麻烦，却能让你的应用性能有很大的提升，所以这个升级还是值得的。如果你对升级 Ionic 3 有什么疑问欢迎给我留言，你也可以参考我写的<a href="https://github.com/SZMSTC/Sample-PengweiSoft/commit/4d5247330d3695ec57af388d025a9d982846588f" target="_blank" rel="noopener">示例项目</a>去尝试解决问题。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2017/publish-ionic-android/" class="prev">PREV</a><a href="/2017/using-signaturepad-in-ionic2/" class="next">NEXT</a></div><div id="SOHUCS" sid="2017/migrate-to-ionic3/" style="padding:0 10px;width:auto;"></div><script charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/changyan.js"></script><script type="text/javascript">window.changyan.api.config({appid: "cyssdmXPE", conf: "prod_a5547932ad75f872719847b1a409c2fb"});</script><div class="copyright"><p>© 2016 - 2019 <a href="http://www.jackytse.me">Jacky Tse</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p><p><a href="http://www.miit.gov.cn" target="_blank">粤ICP备17051421号</a></p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>